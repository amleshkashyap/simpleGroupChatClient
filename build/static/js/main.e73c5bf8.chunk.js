(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{134:function(e,n,t){e.exports=t(349)},339:function(e,n,t){},349:function(e,n,t){"use strict";t.r(n);var a=t(1),r=t.n(a),c=t(23),i=t.n(c),l=t(39),u=t(24),s=t(21),o=t(133),m=t(130),d=t(4),p=t(131),g=t(26),b=t(25),f=t(46),_=t.n(f),v=t(79),h=t(132),O=t(45),y=t.n(O),j=t(126),E=t.n(j),N=t(30),S=t(31),w=t.n(S);function k(){var e=Object(N.a)(["\n  subscription(\n    $group_id: [ String! ]!\n  ) {\n    newChat(group_id: $group_id) {\n\tid\n\tchat_body\n\tsender_email\n\tsender_name\n\tsent_at\n\tgroup_id\n    }\n  }\n"]);return k=function(){return e},e}function C(){var e=Object(N.a)(["\n  mutation (\n    $sender_id: String!\n    $sender_email: String!\n    $sender_name: String!\n    $chat_text: String!\n    $group_id: String!\n    $sent_at: Float!\n  ) {\n    newChat (\n\tsender_id: $sender_id\n\tsender_email: $sender_email\n\tsender_name: $sender_name\n\tchat_text: $chat_text\n\tgroup_id: $group_id\n\tsent_at: $sent_at\n    ) {\n\tid\n\tchat_body\n\tsender_email\n\tsender_name\n\tsent_at\n\tgroup_id\n    }\n  }\n"]);return C=function(){return e},e}function $(){var e=Object(N.a)(["\n  query {\n    chats {\n\tid\n\tchat_body\n\tsender_email\n\tsender_name\n\tgroup_id\n\tsent_at\n    }\n  }\n"]);return $=function(){return e},e}var x=w()($()),q=w()(C()),G=w()(k()),I=Object(u.b)(Object(u.c)(x,{name:"chat"}),Object(u.c)(q,{name:"newChat"}))((function(e){var n=Object(a.useRef)(null),t=Object(a.useState)(""),c=Object(b.a)(t,2),i=c[0],l=c[1],u=Object(a.useState)(null),s=Object(b.a)(u,2);s[0],s[1];Object(a.useEffect)((function(){e.chat.subscribeToMore({document:G,variables:{group_id:N},updateQuery:function(e,n){var t=n.subscriptionData;if(!t.data)return e;var a=t.data.newChat;return e.chats.find((function(e){return e.id===a.id}))?e:Object(g.a)(Object(g.a)({},e),{},{chats:[].concat(Object(h.a)(e.chats),[a])})}}),n.current&&o()}));var o=function(){n.current.scrollIntoView()},m=function(){var e=Object(v.a)(_.a.mark((function e(n){return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:l(n.target.value);case 1:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),d=function(){var n=Object(v.a)(_.a.mark((function n(t,a){var r,c,i;return _.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(l(""),t.preventDefault(),r=e.sender_email,c=e.sender_name,i=e.group_id,a.length){n.next=5;break}return n.abrupt("return",null);case 5:return n.next=7,e.newChat({variables:{sender_id:"5fc4fd303c879950a4419389",sender_email:r,sender_name:c,group_id:i,chat_text:a,sent_at:(new Date).getTime()},update:function(e,n){var t=n.data.newChat,a=e.readQuery({query:x});a.chats.push(t),e.writeQuery({query:x,data:a})}});case 7:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}(),p=e.chat,f=p.error,O=p.loading,j=p.chats,N=e.all_groups,S=e.group_id,w=e.sender_email;e.sender_name;return f||O?null:r.a.createElement("div",{className:"personal-chat",style:e.style},r.a.createElement("div",{className:"chats-header"},r.a.createElement("div",{className:"back-button",onClick:function(){e.setStyle()}},r.a.createElement("div",{className:"bar1"}),r.a.createElement("div",{className:"bar2"}),r.a.createElement("div",{className:"bar3"}))),r.a.createElement("div",{className:"all-chats"},j.map((function(e){return e.group_id===S?r.a.createElement("div",{key:e.id,className:e.sender_email===w?"sender":"receiver"},r.a.createElement("div",{className:"sender-name"},e.sender_name),e.chat_body," ",r.a.createElement("span",{className:"time"}," ",E()(e.sent_at).fromNow())):""}))),S?r.a.createElement("form",{onSubmit:function(e){return d(e,i)},ref:n,className:"chat-box"},r.a.createElement(y.a,{style:{margin:10},placeholder:"Say something",fullWidth:!0,name:"chat",onChange:m,value:i,margin:"normal",variant:"outlined"})):r.a.createElement("div",{className:"select-chat"},"Select a group from the left panel"))})),D=function(e){var n=e.groups,t=e.user,c=e.selectedGroup,i=Object(a.useCallback)((function(e,n){c(e,n)}),[c]);return r.a.createElement("div",{className:"group-welcome",style:e.style},r.a.createElement("div",{className:"group-heading"},r.a.createElement("p",null,"Hello, ",t.name)),r.a.createElement("div",{className:"select-group"},n.map((function(e){return r.a.createElement("div",{key:e.id,className:"groups",onClick:function(){return i(e.id,e.name)}},e.name)}))))},J=t(55),Q=t.n(J),T=t(77),V=t.n(T),z=t(81),B=t.n(z),F=function(e){var n=Object(a.useState)({name:"",email:""}),t=Object(b.a)(n,2),c=t[0],i=t[1],l=Object(a.useState)(""),u=Object(b.a)(l,2),s=u[0],o=u[1],m=function(e){i(Object(g.a)(Object(g.a)({},c),{},{[e.target.name]:e.target.value}))},d=c.name,p=c.email;return r.a.createElement(V.a,{elevation:3,className:"paper"},"User Details",r.a.createElement(y.a,{required:!0,id:"outlined-name",label:"Name",name:"name",value:d,onChange:m,variant:"outlined",style:{margin:10}}),r.a.createElement(y.a,{required:!0,id:"outlined-email-input",type:"email",label:"Email",name:"email",value:p,onChange:m,variant:"outlined",className:"text-area",style:{margin:10}}),r.a.createElement(Q.a,{variant:"contained",onClick:function(){var e=c.name,n=c.email;e.length||o("Name is required"),B.a.isEmail(n)||o("Valid email is required"),e.length&&B.a.isEmail(n)&&(o(""),localStorage.token=JSON.stringify(c))},style:{margin:15}},"Enter Chat"),r.a.createElement("div",null,s))};function H(){var e=Object(N.a)(["\n  query {\n    groups {\n\tid\n\tname\n    }\n   }\n"]);return H=function(){return e},e}var M=w()(H());function R(){var e=Object(N.a)(["\n  query {\n    users {\n\tid\n\tname\n\temail\n    }\n   }\n"]);return R=function(){return e},e}w()(R());var U=Object(u.b)(Object(u.c)(M))((function(e){var n=localStorage.getItem("token")&&JSON.parse(localStorage.getItem("token"))||{},t=Object(a.useState)({receivingGroupId:"",receivingGroupName:""}),c=Object(b.a)(t,2),i=c[0],l=c[1],u=Object(a.useState)(!1),s=Object(b.a)(u,2),o=s[0],m=s[1],d=i.receivingGroupId,p=i.receivingGroupName,f=e.data,_=f.groups,v=f.error;return f.loading||v?null:localStorage.getItem("token")?r.a.createElement("div",{className:"chat-page"},r.a.createElement(D,{style:{display:o?"none":"block"},groups:_,user:n,selectedGroup:function(e,n){l((function(t){return Object(g.a)(Object(g.a)({},t),{},{receivingGroupId:e,receivingGroupName:n})})),m(!o)}}),r.a.createElement(I,{style:{display:o?"block":"none"},sender_email:n.email,sender_id:n._id,sender_name:n.name,all_groups:_.map((function(e){return e.id})),group_id:d,group_name:p,setStyle:function(){m(!o)}})):r.a.createElement(F,null)})),W=(t(339),new o.a({uri:"http://localhost:4000/"})),A=new m.a({uri:"ws://localhost:4000/",options:{reconnect:!0,lazy:!0,inactivityTimeout:3e4}}),K=Object(s.d)((function(e){var n=e.query,t=Object(d.l)(n),a=t.kind,r=t.operation;return"OperationDefinition"===a&&"subscription"===r}),A,W),L=new l.c({link:K,cache:new p.a});i.a.render(r.a.createElement(u.a,{client:L},r.a.createElement(U,null)),document.getElementById("root"))}},[[134,1,2]]]);
//# sourceMappingURL=main.e73c5bf8.chunk.js.map